package cn.kgc.base.chapter07.work;

import java.util.Scanner;

import cn.kgc.base.chapter05.demo.CheckUnit;

/**
 * @author å‘è¿œæ´‹
 * 2024å¹´12æœˆ11æ—¥ ä¸‹åˆ3:05:06
 * åƒè´§è”ç›Ÿè®¢é¤ç³»ç»Ÿ
 * ç”¨æˆ·å¯ä»¥è¿›è¡Œè®¢é¤ã€æŸ¥çœ‹é¤è¢‹ã€ç­¾æ”¶è®¢å•ã€åˆ é™¤è®¢å•ã€ç‚¹èµç­‰æ“ä½œ
 */
public class OrderSystem {
	//èœå“ä¿¡æ¯æ•°é‡
	static int count = 3; 
	static int[] dishId = new int[count];
	static String[] dishName = new String[count];
	static String[] dishAddress = new String[count];
	static double[] dishPrice = new double[count];
	static int[] dishNumber = new int[count];
	static int[] dishPopular = new int[count];
	//è®¢å•ä¿¡æ¯
	static int orders = 2; //è®¢å•æ•°é‡
	static int[] orderId = new int[count];
	static String[] orderTo = new String[count];
	static String[] orderName = new String[count];
	static String[] orderTelephone = new String[count];
	static int[] orderNumber = new int[count];
	static int[] orderTime = new int[count];
	static String[] orderAddress = new String[count];
	static double[] orderCost = new double[count];
	static int[] orderState = new int[count]; //å®ŒæˆçŠ¶æ€
	static String[] orderRemark = new String[count];
	static int[] state = new int[count]; //ç‚¹èµçŠ¶æ€
	
	static final int showTips = 0, showDishs = 1, showOrders = 2; 
	static Scanner input = new Scanner(System.in);
	/**
	 * ä¸»æ–¹æ³•
	 * @param args
	 */
	public static void main(String[] args) {
		initialize();
		System.out.println("æ¬¢è¿ä½¿ç”¨\"åƒè´§è”ç›Ÿè®¢é¤ç³»ç»Ÿ\"");
		while(true) {
			printMes(showTips);
			if(!canOrder()) {
				System.out.println("å•†å®¶ä¸å°å¿ƒæŠŠå•†å“éƒ½ç»™ä¸‹æ¶äº†ï¼");
				Exit();
			}
			int op = CheckUnit.checkIntRange(input, 1, 6);
			switch(op) {
				case 1: 
					order(); 
					break;
				case 2:
					System.out.println("***æŸ¥çœ‹é¤è¢‹***");
					printMes(showOrders);
					break;
				case 3:
					sign();
					break;
				case 4:
					delete();
					break;
				case 5:
					press();
					break;
				case 6:
					Exit();
			}
		}
	}
	
	/**
	 * åˆå§‹ç³»ç»Ÿæ•°æ®
	 */
	static int over = 0; //åç§»é‡ï¼ŒèŒƒå›´[0 ~ dishs.length - count], å¯ä»¥é€šè¿‡åç§»é‡æ¥ä¸Šæ¶ä¸åŒå•†å“
	static String[] dishs = {"çº¢çƒ§å¸¦é±¼", "é±¼é¦™è‚‰ä¸", "æ—¶ä»¤è”¬èœ", "é¦™è¾£çƒ¤é¸­", "èŠ‹åœ†è‘¡è„", "èŒ‰è‰å¥¶ç»¿", "èºè›³ç²‰"};
	static String[] address = {"å²³é˜³ç†å·¥å­¦é™¢åº—", "æ¹–å—ç†å·¥å­¦é™¢äºŒé£Ÿå ‚", "æ¹–å—ç†å·¥å­¦é™¢äºŒé£Ÿå ‚", "å²³é˜³ç†å·¥å­¦é™¢åº—", "èœœé›ªå†°åŸ", "èœœé›ªå†°åŸ", "å²³é˜³ç†å·¥äºŒé£Ÿå ‚"};
	static double[] prices = {38, 28, 18.8, 45.9, 9.9, 8, 13}; 
	static int[] popular = {10, 12, 4, 16, 30, 28, 79};
	static int[] number = {15, 15, 20, 10, 40, 40, 99};
	/**
	 * åˆå§‹åŒ–æ•°æ®
	 */
	static void initialize() {
		for(int i = 0; i < count; i++) {
			//èœå“
			dishId[i] = i + 1; //é€šè¿‡idæ‰¾å…¶ä»–å±æ€§æ˜¯è¦æ³¨æ„-1
			dishName[i] = dishs[i + over];
			dishAddress[i] = address[i + over];
			dishPrice[i] = prices[i + over];
			dishPopular[i] = popular[i + over];
			dishNumber[i] = number[i + over];
			//è®¢å•
			if(i < orders) { //å³åˆå§‹åªæœ‰2æ¡è®¢å•ï¼Œå³orders = 2
				orderId[i] = i + 1;
				orderTo[i] = "å‘è¿œæ´‹";
				orderName[i] = dishs[i];
				orderTelephone[i] = "12345678901";
				orderNumber[i] = i + 1; // iä»0å¼€å§‹ï¼Œä½†æ˜¯å•†å“æ•°é‡ä¸èƒ½ä¸º0 [0 å¯¹åº” 1ï¼Œ åé¢é€šè¿‡åºå·æ‰¾å¯¹åº”å•†å“ï¼Œåº”è¯¥-1]
				orderCost[i] = totalMoney(orderName[i], orderNumber[i]);
				orderTime[i] = 10;
				orderAddress[i] = "å—äº”727";
				orderState[i] = i % 2; //0 1ä¸¤ç§çŠ¶æ€
				orderRemark[i] = "è€æ¿ï¼åŠ ç‚¹é¥­ï¼ï¼ï¼";
				state[i] = orderState[i]; //é€è¾¾äº†æ‰èƒ½ç‚¹èµï¼Œæœªé€è¾¾ä¸èƒ½ç‚¹èµ
			}
		}
		
	}
	
	/**
	 * é›†æˆæ‰“å°å‡½æ•°ï¼Œé€šè¿‡ä¸åŒçš„æ“ä½œç¬¦ï¼Œè¾“å‡ºä¸åŒä¿¡æ¯
	 * @param op
	 */
	static void printMes(int op) {
		switch(op) {
			case showTips:
				System.out.println("****************************");
				System.out.println("1ã€æˆ‘è¦è®¢é¤");
				System.out.println("2ã€æŸ¥çœ‹é¤è¢‹");
				System.out.println("3ã€ç­¾æ”¶è®¢å•");
				System.out.println("4ã€åˆ é™¤è®¢å•");
				System.out.println("5ã€æˆ‘è¦ç‚¹èµ");
				System.out.println("6ã€é€€å‡ºç³»ç»Ÿ");
				System.out.println("****************************");
				System.out.print("è¯·é€‰æ‹©ï¼š");
				break;
			case showDishs:
				//ç¼–å·ã€åç§°ã€åœ°å€ã€ä»·æ ¼ã€èµæ•°ã€åº“å­˜
				System.out.println("=============================èœå“ä¿¡æ¯====================================");
				System.out.printf("%-5s%-10s%-10s%-10s%-10s%-15s\n", "åºå·", "èœå", "å•ä»·", "èµæ•°", "åº“å­˜", "å•†å®¶åœ°å€");
				for(int i = 0; i < count; i++) {
					System.out.printf("%-5d%-10s%-11s%-12s%-10d%-10s\n",
						dishId[i], dishName[i], (String.format("%.1f", dishPrice[i]) + "å…ƒ"), (dishPopular[i] + "ğŸ–’ "), dishNumber[i], dishAddress[i]);
				}
				break;
			case showOrders:
				System.out.println("==================================================è®¢å•ä¿¡æ¯==========================================================");
				System.out.printf("%-5s%-10s%-10s%-10s%-10s%-10s%-10s%-15s%-10s%5s\n",
						"åºå·", "è®¢é¤äºº", "é¤å“ä¿¡æ¯", "é€é¤æ—¶é—´", "é€é¤åœ°å€", "æ€»é‡‘é¢", "è®¢å•çŠ¶æ€", "ç”µè¯", "å¤‡æ³¨", "   ");
				for(int i = 0; i < orders; i++) { 
					if(orderName[i] != null) { //orderNameæ˜¯å¦ä¸ºç©ºåˆ¤æ–­è®¢å•æ˜¯å¦å­˜åœ¨ï¼Œååºåªéœ€è¦é€šè¿‡è®¾ç½®orderNameä¸ºnullæ¥åˆ¤æ–­è®¢å•æ˜¯å¦å­˜åœ¨
						System.out.printf("%-6d%-10s%-10s%-10s%-10s%-13s%-10s%-15s%-10s%5s\n",
							orderId[i], orderTo[i], (orderName[i] + "(" +orderNumber[i] + "ä»½)"), 
							("" + orderTime[i] + "ç‚¹ "), ("" + orderAddress[i]), ("" + String.format("%.1f", orderCost[i]) + "å…ƒ"), 
							("" + getState(orderState[i])), ("" + orderTelephone[i]), ("" + orderRemark[i]), (state[i] == 0 ? "   " : "[å·²ç‚¹èµ]"));						
					}
				}
				break;
		}
	}
	
	/**
	 * ç‚¹é¤
	 */
	static void order() {
		boolean isHave = true; //æ˜¯å¦æœ‰åº“å­˜
		while(true) {
			System.out.println("***æˆ‘è¦è®¢é¤***");
			boolean isFull = false;
			isHave = true;
			int i;
			for(i = 0; i < count; i++) {
				if(orderName[i] == null) { //ä¸€ä¸ªæ–°è®¢å•äº§ç”Ÿï¼Œåº”è¯¥å°†è¯¥è®¢å•æ‰€æœ‰å±æ€§èµ‹å€¼ã€‚
					System.out.print("è¯·è¾“å…¥è®¢é¤äººå§“åï¼š");
					orderTo[i] = CheckUnit.checkString(input, 0);
					printMes(showDishs); //ç»™å‡ºèœå“ä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·çœ‹
					System.out.print("è¯·é€‰æ‹©æ‚¨è¦ç‚¹çš„èœå“ç¼–å·:");
					int Mes = CheckUnit.checkIntRange(input, 1, count); //ç¼–å·åº”è¯¥åœ¨[1~count]ä¸­ï¼Œä¿è¯count>1
					orderId[i] = orders+1;
					System.out.print("è¯·é€‰æ‹©æ‚¨è¦ç‚¹çš„èœå“æ•°é‡:");
					orderNumber[i] = CheckUnit.checkIntRange(input, 1, getNumById(Mes)); //è¯¥å‡½æ•°æä¾›äº†æ ¹æ®èœå“ç¼–å·æ‰¾åº“å­˜
					if(orderNumber[i] == -1) {
						isHave = false;
						break;
					}
					isFull = true;
					System.out.print("è¯·è¾“å…¥é€é¤æ—¶é—´ï¼ˆé€é¤æ—¶é—´æ˜¯10ç‚¹è‡³20ç‚¹é—´æ•´ç‚¹é€é¤ï¼‰:");
					orderTime[i] = CheckUnit.checkIntRange(input, 10, 20);
					System.out.print("è¯·è¾“å…¥é€é¤åœ°å€:");
					orderAddress[i] = CheckUnit.checkString(input, 1);
					System.out.print("è¯·è¾“å…¥ç”µè¯å·ç :");
					orderTelephone[i] = CheckUnit.checkString(input, 2);
					System.out.print("è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯:");
					orderRemark[i] = CheckUnit.checkString(input, 1);
					orderState[i] = 0; //æ­¤æ—¶è®¢å•åº”è¯¥åˆšç”Ÿæˆï¼Œè®¾ç½®ä¸º0
					orderName[i] = dishName[Mes - 1]; //-1æ˜¯å› ä¸ºå®šä¹‰dishNameæ—¶å·®å¼‚ï¼Œå¯ä»¥æŸ¥çœ‹åˆå§‹åŒ–é‚£ä¸€å—
					orderCost[i] = orderNumber[i] * dishPrice[Mes - 1];
					//åŠæ—¶ä¿®æ”¹èœå“ä¿¡æ¯
					dishNumber[Mes - 1] -= orderNumber[i];
					//å¦‚æœå¯ä»¥ä¸‹å•ï¼ˆæ•°ç»„æœªæ»¡ï¼‰ï¼Œåªè¿›è¡Œä¸€æ¬¡ï¼Œä¸ç„¶ä¸€æ¬¡ä¸‹å•å ç”¨å¤šä¸ªorderæ•°ç»„å…ƒç´ ï¼ŒåŠæ—¶break
					break;
				}
			}
			//è®¢é¤æˆåŠŸ
			if(isFull) {
				double tip = Math.random() * 9 + 1;
				System.out.println("è®¢é¤æˆåŠŸï¼");
				System.out.println("---------------------");
				System.out.println("| " + orderName[i] + "(" + orderNumber[i] + "ä»½)");
				System.out.println("---------------------");
				System.out.println("| é€é¤æ—¶é—´ï¼š" + orderTime[i] + "ç‚¹");
				System.out.println("---------------------");
				System.out.println("| é€é¤åœ°å€ï¼š" + orderAddress[i]);
				System.out.println("---------------------");
				System.out.println("| ç”¨æˆ·ä¿¡æ¯ï¼š" + orderTo[i].charAt(0) + "å…ˆç”Ÿ/å¥³å£«(" + orderTelephone[i].substring(0, 3) + "****" + orderTelephone[i].substring(7, 11) + ")");
				System.out.println("---------------------");
				System.out.println("| ç”¨æˆ·å¤‡æ³¨ï¼š" + orderRemark[i]);
				System.out.println("---------------------");
				int digit = 0;
				if(orderNumber[i] + tip + orderCost[i] >= 50) {
					digit = ((int)orderCost[i]/10); //å‡å…ï¼Œæœ€å¤šå‡å…50
					if(digit > 50) {
						digit = 50;
					}
					System.out.printf("| é¤è´¹ï¼š%.1f*(%dä»½)=%.1få…ƒ, é…é€è´¹%.1få…ƒ, æ‰“åŒ…è´¹%då…ƒï¼Œå¹³å°æ¶ˆè´¹è¶…è¿‡%då…ƒï¼Œèµ é€%då…ƒå‡å…å·ï¼æ€»è®¡ï¼š%.1få…ƒ\n", 
							dishPrice[orderId[i] - 1], orderNumber[i], orderCost[i], tip, orderNumber[i], (int)orderCost[i], digit, (tip + orderCost[i] - digit));
				}
				else {
					System.out.printf("| é¤è´¹ï¼š%.1f*(%dä»½)=%.1få…ƒ, é…é€è´¹%.1få…ƒï¼Œæ€»è®¡ï¼š%.1få…ƒ\n", 
							dishPrice[orderId[i] - 1], orderNumber[i], orderCost[i], tip, (tip + orderCost[i]));				
				}
				orders++;
				orderCost[i] += (tip + orderNumber[i]);
				orderCost[i] -= digit; 
				System.out.println("---------------------");
				
			} else if(!isHave) {
				System.out.println("æœ¬æ¬¡ç‚¹é¤å¤±è´¥ï¼");
			} else {
				System.out.println("è®¢é¤å¤±è´¥ï¼Œæ‚¨çš„ç‚¹é¤è½¦å·²æ»¡ï¼");
			}
			System.out.println("æ˜¯å¦ç»§ç»­ç‚¹é¤ï¼Œè¾“å…¥né€€å‡ºç‚¹é¤ å…¶ä»–é”®ç»§ç»­ç‚¹é¤");
			String op = input.next();
			if(op.equals("n")) {
				return;
			}
		}
	}
	
	
	/**
	 * ç­¾æ”¶è®¢å•
	 */
	static void sign() {
		System.out.println("***ç­¾æ”¶è®¢å•***");
		while(true) { 

			printMes(showOrders);
			System.out.print("è¯·é€‰æ‹©è¦ç­¾æ”¶çš„è®¢å•åºå·:");	
			int Id;
			Id = CheckUnit.checkInt(input);
			if(Id < 1 || Id > orders)
				System.out.println("ç­¾æ”¶å¤±è´¥ï¼æ‚¨é€‰æ‹©çš„è®¢å•ä¸å­˜åœ¨ï¼\n");
			else if(orderState[Id - 1] == 1) {
				System.out.println("ç­¾æ”¶å¤±è´¥ï¼æ‚¨å·²ç»ç­¾æ”¶è¿‡è¯¥å®šå•äº†!\n");
			} else {
				System.out.println("ç­¾æ”¶æˆåŠŸï¼");
				orderState[Id - 1] = 1; 
			}
			System.out.println("æ˜¯å¦è¦ç»§ç»­ç­¾æ”¶è®¢å•ï¼ŸæŒ‰né€€å‡ºç­¾æ”¶è®¢å•ï¼ŒæŒ‰å…¶ä»–åˆ™ç»§ç»­~");
			String Mes = input.next();
			if(Mes.equals("n")) {
				return;
			}
		}
	}
	
	/**
	 * åˆ é™¤è®¢å•
	 */
	static void delete() {
		System.out.println("***åˆ é™¤å®šå•***");
		while(true) { 
			if(orders == 0) {
				System.out.println("æ— è®¢å•è¿›è¡Œåˆ é™¤ï¼ï¼ï¼");
			}else {
				printMes(showOrders); 
				System.out.print("è¯·è¾“å…¥è¦åˆ é™¤çš„è®¢å•åºå·:");
				int Id;
				Id = CheckUnit.checkInt(input);
				if(Id < 1 || Id > orders)
					System.out.println("åˆ é™¤å¤±è´¥ï¼æ‚¨é€‰æ‹©çš„è®¢å•ä¸å­˜åœ¨ï¼\n");
				else {
					move(Id - 1); // æ‰§è¡Œåˆ é™¤æ“ä½œ
					System.out.println("åˆ é™¤æˆåŠŸï¼");
				}
			}
			System.out.println("æ˜¯å¦è¦ç»§ç»­åˆ é™¤è®¢å•ï¼ŸæŒ‰né€€å‡ºç­¾æ”¶è®¢å•ï¼ŒæŒ‰å…¶ä»–åˆ™ç»§ç»­~");
			String Mes = input.next();
			if(Mes.equals("n") || Mes.charAt(0) == 'n') {
				return;
			}
		}
		
	}
	
	static void move(int idx) { //åˆ é™¤orderæ•°ç»„ä¿¡æ¯ï¼Œä¼ å‚æ—¶è®°å¾—ä¼ å…¥è®¢å•åºå·å¯¹åº”ä¸‹æ ‡ï¼ˆæ¯”å¦‚1å·è®¢å•åœ¨orderæ•°ç»„ä¸­ä¸‹æ ‡ä¸º0ï¼‰
		for(int i = idx + 1; i < orders; i++) { 
			orderTo[i-1] = orderTo[i];
			orderName[i-1] = orderName[i];
			orderTelephone[i-1] = orderTelephone[i];
			orderNumber[i-1] = orderNumber[i];
			orderTime[i-1] = orderTime[i];
			orderAddress[i-1] = orderAddress[i];
			orderCost[i-1] = orderCost[i];
			orderState[i-1] = orderState[i];
			orderRemark[i-1] = orderRemark[i];
			state[i-1] = state[i];
		}
		orders--;
		orderName[orders] = null; 
	}
	
	static void press() {
		System.out.println("***ç‚¹èµè®¢å•***");
		while(true) {
			printMes(showOrders);
			System.out.print("è¯·è¾“å…¥è¦ç‚¹èµçš„è®¢å•åºå·:");
			int Id;
			Id = CheckUnit.checkInt(input);
			if(Id < 1 || Id > orders)
				System.out.println("ç‚¹èµå¤±è´¥ï¼æ‚¨é€‰æ‹©çš„è®¢å•ä¸å­˜åœ¨ï¼\n");
			else if(state[Id - 1] == 1) {
				System.out.println("ç‚¹èµå¤±è´¥ï¼æ‚¨å·²ç»èµè¿‡è¯¥å®šå•äº†!");
				System.out.println("æ‚¨è¦å–æ¶ˆç‚¹èµå—ï¼Ÿå–æ¶ˆè¯·æŒ‰n,æŒ‰å…¶ä»–åˆ™ä¿ç•™è¯¥èµ~");
				String Mes = input.next();
				if(Mes.equals("n")) {
					state[Id-1] = 0;
				}
			} else {
				System.out.println("ç‚¹èµæˆåŠŸï¼");
				state[Id - 1] = 1; //ç‚¹èµåè®°å¾—ä¿®æ”¹çŠ¶æ€ï¼Œ åŒæ—¶è¡¨ç¤ºè®¢å•å·²å®Œæˆ
				orderState[Id - 1] = 1;
			}
			System.out.println("æ˜¯å¦è¦ç»§ç»­ç‚¹èµè®¢å•ï¼ŸæŒ‰né€€å‡ºç‚¹èµç•Œé¢ï¼ŒæŒ‰å…¶ä»–åˆ™ç»§ç»­~");
			String Mes = input.next();
			if(Mes.equals("n")) {
				return;
			}
		}
	}
	
	static int getNumById(int id) {
		return dishNumber[id - 1];
	}
	
	static double totalMoney(String str, int num) {
		//æ‰¾åˆ°strèœå“åœ¨dishsæ•°ç»„çš„ä¸‹æ ‡ï¼Œä»è€Œæ‰¾åˆ°å¯¹åº”å¾—åˆ°ä»·æ ¼prices
		int idx = 0;
		for(int i = 0; i < dishs.length; i++) {
			if(str.equals(dishs[i])) {
				idx = i;
				break;
			}
		}
		return ((double)prices[idx] * num);
	}
	
	static String getState(int state) {
		return (state == 0 ? "æœªå®Œæˆ" : "å·²å®Œæˆ");
	}
	
	static boolean canOrder() {
		boolean hasCount = false;
		for(int i = 0; i < count; i++) {
			if(dishName[i] != null) 
				hasCount = true;
		}
		return hasCount;
	}
	static void Exit() {
		input.close();
		System.out.println("æ¬¢è¿ä¸‹æ¬¡");
		System.exit(0);
	}
}

